#!/usr/bin/env bash

# Check if a path is provided
if [ -z "$1" ]; then
  echo "Usage: $0 <path>"
  exit 1
fi

# Initialize an empty array to store the deleted folders
deleted_folders=()

# Function to delete 'node_modules' folder
delete_node_modules() {
  local folder="$1"
  
  for entry in "$folder"/*; do
    if [ -d "$entry" ]; then
      if [ "$(basename "$entry")" == "node_modules" ]; then
        echo "Deleting node_modules folder in $folder"
        rm -rf "$entry"
        deleted_folders+=("$folder")
      else
        delete_node_modules "$entry"
      fi
    fi
  done
}

# Call the delete_node_modules function with the provided path
delete_node_modules "$1"

echo "Finished deleting 'node_modules' folders."

# Print the list of folders with their absolute paths
echo "List of folders where 'node_modules' has been deleted:"
for folder in "${deleted_folders[@]}"; do
  echo "- $(realpath "$folder")"
done
